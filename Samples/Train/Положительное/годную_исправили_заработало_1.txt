Нашли годную наработку, немного исправили, и заработало.